<include file="Public:header" title="资料"/> 
	<include file="User:user_header"/>
		<div class="person-profile">
			<div class="info">
				<div class="title">
					<div class="text"><span>基本信息</span></div>
					<div class="line"><span></span></div>
					<eq name="me" value="1">
						<eq name="modify" value="0">
							<div class="button" id="modifyprofile">编辑资料</div>
						<else/>
							<div class="button" id="updateprofile">确认编辑</div>
						</eq>
						
						<div id="userid" style="display:none;">{$user.id}</div>
					</eq>
				</div>
				<eq name="me" value="0">
				<div class="detail">
					<ul>
						<li>
							<div class="key">昵称</div>
							<div class="value" id="nickname">{$user.name}</div>
						</li>
						<li>
							<div class="key">性别</div>
							<if condition="$user.sex eq male">
								<div class="value" id="sex">男</div>
							<elseif condition="$user.sex eq female"/>
								<div class="value" id="sex">女</div>
							<else/>
								<div class="value" id="sex">未知</div>
							</if>
						</li>
						<li>
							<div class="key">学院</div>
							<empty name="user.dept">
								<div class="value" id="dept">未知</div>
							<else/>
								<div class="value" id="dept">{$user.dept}</div>
							</empty>
						</li>
						<li>
							<div class="key">年级</div>
							<empty name="user.grade">
								<div class="value" id="grade">未知</div>
							<else/>
								<div class="value" id="grade">{$user.grade}</div>
							</empty>
						</li>
						<li>
							<div class="key">校区</div>
							<empty name="user.campus">
								<div class="value" id="campus">未知</div>
							<else/>
								<div class="value" id="campus">{$user.campus}</div>
							</empty>
						</li>
						<li>
							<div class="key">个性签名</div>
							<empty name="user.intro">
								<div class="value" id="intro">还没有填写个人签名</div>
							<else/>
								<div class="value" id="intro">{$user.intro}</div>
							</empty>
						</li>
						<li>
							<div class="key">QQ</div>
							<empty name="user.qq">
								<div class="value" id="qq">还没有填写qq号</div>
							<else/>
								<div class="value" id="qq">{$user.qq}</div>
							</empty>
						</li>
						<li>
							<div class="key">邮箱</div>
							<empty name="user.email">
								<div class="value" id="email">还没有填写邮箱地址</div>
							<else/>
								<div class="value" id="email">{$user.email}</div>
							</empty>
						</li>
						<li>
							<div class="key">微博</div>
							<empty name="user.weibo">
								<div class="value" id="weibo">还没有填写微博昵称</div>
							<else/>
								<div class="value" id="weibo">{$user.weibo}</div>
							</empty>
						</li>
					</ul>
				</div>
				<else/>
				<eq name="modify" value="0">
				<div class="detail">
					<ul>
						<li>
							<div class="key">昵称</div>
							<div class="value" id="nickname">{$user.name}</div>
						</li>
						<li>
							<div class="key">性别</div>
							<if condition="$user.sex eq male">
								<div class="value" id="sex">男</div>
							<elseif condition="$user.sex eq female"/>
								<div class="value" id="sex">女</div>
							<else/>
								<div class="value" id="sex">未知</div>
							</if>
						</li>
						<li>
							<div class="key">学院</div>
							<empty name="user.dept">
								<div class="value" id="dept">未知</div>
							<else/>
								<div class="value" id="dept">{$user.dept}</div>
							</empty>
						</li>
						<li>
							<div class="key">年级</div>
							<empty name="user.grade">
								<div class="value" id="grade">未知</div>
							<else/>
								<div class="value" id="grade">{$user.grade}</div>
							</empty>
						</li>
						<li>
							<div class="key">校区</div>
							<empty name="user.campus">
								<div class="value" id="campus">未知</div>
							<else/>
								<div class="value" id="campus">{$user.campus}</div>
							</empty>
						</li>
						<li>
							<div class="key">个性签名</div>
							<empty name="user.intro">
								<div class="value" id="intro">还没有填写个人签名</div>
							<else/>
								<div class="value" id="intro">{$user.intro}</div>
							</empty>
						</li>
						<li>
							<div class="key">QQ</div>
							<empty name="user.qq">
								<div class="value" id="qq">还没有填写qq号</div>
							<else/>
								<div class="value" id="qq">{$user.qq}</div>
							</empty>
						</li>
						<li>
							<div class="key">邮箱</div>
							<empty name="user.email">
								<div class="value" id="email">还没有填写邮箱地址</div>
							<else/>
								<div class="value" id="email">{$user.email}</div>
							</empty>
						</li>
						<li>
							<div class="key">微博</div>
							<empty name="user.weibo">
								<div class="value" id="weibo">还没有填写微博昵称</div>
							<else/>
								<div class="value" id="weibo">{$user.weibo}</div>
							</empty>
						</li>
					</ul>
				</div>	
				<else/>
				<div class="row" style="display:none">
					<input id="rawpath" name="rawpath" type="text"/>
					<input id="thumbpath" name="thumbpath" type="text"/>
				</div>
				<div class="detail" style="display:none;">
					<ul>
						<li>
							<div class="key">昵称</div>
							<div class="value" id="nickname">{$user.name}</div>
						</li>
						<li>
							<div class="key">性别</div>
							<div class="value" id="sex">{$user.sex}</div>
						</li>
						<li>
							<div class="key">学院</div>
							<div class="value" id="dept">{$user.dept}</div>
						</li>
						<li>
							<div class="key">年级</div>
							<div class="value" id="grade">{$user.grade}</div>
						</li>
						<li>
							<div class="key">校区</div>
							<div class="value" id="campus">{$user.campus}</div>
						</li>
						<li>
							<div class="key">个性签名</div>
							<div class="value" id="intro">{$user.intro}</div>
						</li>
						<li>
							<div class="key">QQ</div>
							<div class="value" id="qq">{$user.qq}</div>
						</li>
						<li>
							<div class="key">邮箱</div>
							<div class="value" id="email">{$user.email}</div>
						</li>
						<li>
							<div class="key">微博</div>
							<div class="value" id="weibo">{$user.weibo}</div>
						</li>
					</ul>
				</div>
				<div class="modify">
					<div class="intro">
					<ul>
						<li>
							<div class="key">昵称</div>
							<div class="value"><input id="usernickname" type="text"/></div>
						</li>
						<li>
							<div class="key">性别</div>
							<div class="value">
								<select name="feeling" tabindex="3" id="usersex" >
									<option value="" >未知</option>
									<option value="男" >男</option>
									<option value="女" >女</option>
									
								</select>
							</div>
						</li>
						<li>
							<div class="key">学院</div>
							<div class="value">
								<select id='userdept' name='dept' class='select' tabindex='6' >
									<option value=''>院系</option>
									<option value='建筑学院'>建筑学院</option>
									<option value='机械工程学院'>机械工程学院</option>
									<option value='能源与环境学院'>能源与环境学院</option>
									<option value='信息科学与工程学院'>信息科学与工程学院</option>
									<option value='土木工程学院'>土木工程学院</option>
									<option value='电子科学与工程学院'>电子科学与工程学院</option>
									<option value='数学系'>数学系</option>
									<option value='自动化学院'>自动化学院</option>
									<option value='计算机科学与工程学院'>计算机科学与工程学院</option>
									<option value='物理系'>物理系</option>
									<option value='生物科学与医学工程学院'>生物科学与医学工程学院</option>
									<option value='材料科学与工程学院'>材料科学与工程学院</option>
									<option value='人文学院'>人文学院</option>
									<option value='经济管理学院'>经济管理学院</option>
									<option value='电气工程学院'>电气工程学院</option>
									<option value='外国语学院'>外国语学院</option>
									<option value='体育系'>体育系</option>
									<option value='化学化工学院'>化学化工学院</option>
									<option value='交通学院'>交通学院</option>
									<option value='仪器科学与工程学院'>仪器科学与工程学院</option>
									<option value='艺术学院'>艺术学院</option>
									<option value='法学院'>法学院</option>
									<option value='医学院'>医学院</option>
									<option value='公共卫生学院'>公共卫生学院</option>
									<option value='吴健雄学院'>吴健雄学院</option>
									<option value='软件学院'>软件学院</option>
									<option value='成贤学院'>成贤学院</option>
									<option value='集成电路（IC）学院'>集成电路（IC）学院</option>
									<option value='其它院系'>其它院系</option>
								</select>
							</div>
						</li>
						<li>
							<div class="key">年级</div>
							<div class="value">
								<select name="feeling" tabindex="3" id="usergrade" >
									<option value="">年级</option>
									<option value="本科一年级">本科一年级</option>
									<option value="本科二年级">本科二年级</option>
									<option value="本科三年级">本科三年级</option>
									<option value="本科四年级">本科四年级</option>
									<option value="研究生一年级">研究生一年级</option>
									<option value="研究生二年级">研究生二年级</option>
									<option value="研究生三年级">研究生三年级</option>
								</select>
							</div>
						</li>
						<li>
							<div class="key">校区</div>
							<div class="value">
								<select name="feeling" tabindex="3" id="usercampus" >
									<option value="">校区</option>
									<option value="九龙湖">九龙湖</option>
									<option value="四牌楼">四牌楼</option>
									<option value="丁家桥">丁家桥</option>			
								</select>
							</div>
						</li>
						<li>
							<div class="key">个性签名</div>
							<div class="value"><input id="userintro" type="text"/></div>
						</li>
						<li>
							<div class="key">QQ</div>
							<div class="value"><input id="userqq" type="text"/></div>
						</li>
						<li>
							<div class="key">邮箱</div>
							<div class="value"><input id="useremail" type="text"/></div>
						</li>
						<li>
							<div class="key">微博</div>
							<div class="value"><input id="userweibo" type="text"/></div>
						</li>
					</ul>
					</div>
					<div class="divide">
					</div>
					<div class="icon">
						<div class="title">
							<div class="text"><span>修改头像</span></div>
							<div class="line"></div>
							<div class="button"><input id="icon" name="icon" type="file"/>上传照片</div>
						</div>
						<!-- <div class="div-image">
							<div class="target">
								<img src="{$user.raw_icon}" id="target" style="width:712px;height:505px;"/>
							</div>
							<div class="preview">
								<img src="{$user.icon}" id="preview" />
							</div>
						</div> -->
					</div>
					<div class="row" id="div_image">
						<table>
							<td><img src="{$user.raw_icon}" id="target" style="width:222px;overflow:hidden;"/></td>
							<td>
								<div style="width:48px;height:48px;overflow:hidden;margin-left:5px;">
									<img src="{$user.icon}" id="preview"/>
								</div>
							</td>
						</table>
					</div>
				</div>
				</eq>
				</eq>
			</div>
			<!--<div class="tag">
				<div class="title">
					<eq name="me" value="1">
						<span>我的标签</span>
						<span class="divide"></span>
						<a href="#">管理</a>
					<else/>
						<span>标签</span>
						<span class="divide"></span>
					</eq>
				</div>
				<div class="detail">
					<div class="content">
						<span>九龙湖-橘园九龙湖-橘园</span>
					</div>
					<div class="content">
						<span>灌篮高手</span>
					</div>
					<div class="content">
						<span>互联网微波</span>
					</div>
					<div class="content ">
						<span>微波毫米</span>
					</div>
					<div class="content">
						<span>动漫宅</span>
					</div> 
				</div>
			</div>-->
		</div>
		<include file="User:user_trace" />
		<div class="clear">
		</div>
	</div>
	<script src="__JS__/jquery.Jcrop.js?t=1395387039"></script>
	<script src="__JS__/jquery.color.js?t=1395387039"></script>
	<script src="__JS__/ajaxfileupload.js?t=1395387039"></script>
	<link rel="stylesheet" href="__CSS__/jquery.Jcrop.css?t=1395387039" type="text/css" />
	<script>
		$(function(){
			$("#modifyprofile").click(function(){
				var userid = $("#userid").text().replace(/[ ]/g,"");
				window.location.href = '/user/profile/'+userid+'/1';
			});

			$("#updateprofile").click(function(){
				if(iconWidth && iconHeight){
					iconX=iconX*width/imageWidth;
					iconWidth=iconWidth*width/imageWidth;
					iconY=iconY*height/imageHeight;
					iconHeight=iconHeight*height/imageHeight;
					$.post('/user/thumb_icon', {
						imagepath: '.'+$('#target').attr('src'),
						iconx: iconX,
						icony: iconY,
						width: iconWidth,
						height: iconHeight
					}, function(data){
						$('#rawpath').val(data.data.rawpath.replace(".", ""));
						$('#thumbpath').val(data.data.thumbpath.replace(".", ""));
						postProfileData();
					}, 'json');
				}
				else{
					postProfileData();
				}
			});

			function postProfileData(){
				var userid = $("#userid").text().replace(/[ ]/g,"");
				if($("#nickname").text().replace(/[ ]/g,"")){
					$.post("/user/update_profile", {
						"rawpath": $("#rawpath").val(),
						"thumbpath": $("#thumbpath").val(),
						"id": $("#userid").text().replace(/[ ]/g,""),
						"sex": $('#usersex').find("option:selected").text().replace(/[ ]/g,""), 
						"dept": $('#userdept').find("option:selected").text().replace(/[ ]/g,""),
						"grade": $('#usergrade').find("option:selected").text().replace(/[ ]/g,""),
						"campus": $('#usercampus').find("option:selected").text().replace(/[ ]/g,""),
						"intro": $('#userintro').val(),
						"qq": $('#userqq').val().replace(/[ ]/g,""),
						"email": $('#useremail').val().replace(/[ ]/g,""),
						"weibo": $('#userweibo').val().replace(/[ ]/g,""),
						"nickname": $("#usernickname").val().replace(/[ ]/g,"")
					}, function(data){
						if(data.status == 1){
							alert("修改资料成功");
							window.location.href = '/user/profile/'+userid+'/0';
						}else if(data.status == 3){
							alert("该昵称已经被别人用掉啦，想一个其他的吧");
						}else{
							alert("请修改信息中的内容");
							window.location.href = '/user/profile/'+userid+'/0';
						} 
					}, "json");
				}else{
					alert("请填写你的昵称");
				}
			}

			$('#icon').change(function(){		
				ajaxFileUpload();
			});
		});
	</script>
	<script src="__JS__/user/user_profile.js?t=1395387039"></script>
<include file="Public:footer" />